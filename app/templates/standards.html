{% extends "base.html" %}

{% block head %}
    {{ super() }}
{% endblock %}

{% block content %}

<h1>{{ serviceid }} Service Standards</h1>

<form action="/servicestandards" method="post">

    <table id="standards-table">
        <thead>
            <tr>
                <th id="service-col1">SSN</th>
                <th id="service-col2">Service Description</th>
                <th id="service-col3">Action</th>
            </tr>
        </thead>
        <tbody>
           {% for row in standards %}
        <tr>
            <td>
                <input type="hidden" name="id" value="{{ row.stdid }}">
                <input name="ssn" type="text" size="8" value="{{ row.ssn }}">
            </td>
            <td>
                <textarea name="service-description" rows="3" cols="100" class="multi-line">{{ row.description }}</textarea>     
            </td>
            <td>
                {% if row.stdid %}
                <form action="/delete/{{ row.stdid }}" method="post" style="display:inline">
                    <button type="submit" class="small-button">Delete</button>
                </form>
                {% endif %}
            </td>
        </tr>
    {% endfor %}
        </tbody>
    </table>
    <br>
    <button type="button" class="button" id="add-row-btn">Add Row</button>
    <input type="submit" class="button" id="submit-btn" value="Save Changes">
    <a href="{{ url_for('index') }}" class="button">Back</a>
</form>

<script>
    document.addEventListener('DOMContentLoaded', function () {
    const tableBody = document.querySelector('#standards-table tbody');
    const addBtn = document.getElementById('add-row-btn');

    addBtn.addEventListener('click', () => {
        const row = document.createElement('tr');
        row.innerHTML = `
            <td>
                <input type="hidden" name="id" value="">
                <input name="ssn" type="text" size="8" value="">
            </td>
            <td>
                <textarea name="service-description" type="text" rows="3" cols="100" class="multi-line"></textarea>     
            </td>
            <td>                    
                                
            </td>
        `;
        tableBody.appendChild(row);
    });

    // Only remove row from DOM for new (unsaved) rows
    tableBody.addEventListener('click', (e) => {
        if (e.target && e.target.classList.contains('remove-btn') && e.target.type === "button") {
            const row = e.target.closest('tr');
            row.remove();
        }
    });
});
</script>

{% endblock %}