<!DOCTYPE html>

{% extends "base.html" %}
{% block title %}CS Document Generator v0.3{% endblock %}
{% block head %}
    {{ super() }}
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

{% endblock %}

{% block content %}

    <h1>Document Generator</h1>

    <div class="c7grid"> 
        <div> <!-- column 1 - search combo -->
            <!-- Service ID -->
            <!-- Tech debt: do we need to duplicate the entire block or can we be smarter with action and button only? --> 
            {% if session['candidate_search_string'] %}    
            <form action="clearsession" method="post">
                <label for="sid" class="index-label"><strong>Service Provider</strong></label>
                <p>
                    <input type="text" id="sid" value="{{ session['candidate_search_string'] }}" autocomplete="off" class="name-textbox" readonly>                        
                </p>
            
                <input type="submit" value="RESET" id="reset-btn" class="button"/>
                
            </form>
            {% else %}        
            <form action="setsid" method="post">
                <label for="sid" class="index-label"><strong>Service Provider</strong></label>
                <div>
                    <input type="text" id="sid" name="sid" placeholder="Type a candidate surname..." autocomplete="off" class="name-textbox">
                        <div id="suggestions"></div>
                </div>
            
                <input type="submit" value="Set" id="submit-btn" class="button"/>
            
            </form>
            {% endif %}   
        </div>
        
        <div> <!-- column 2 - data views -->
            <div>
                <form action="colleaguedata" method="get">
                    {% if session['sessionContract'] %}
                        <input type="submit" value="Colleague Data" id="add-btn" class="button"/>
                    {% else %}
                        <input type="submit" value="Colleague Data" id="submit-btn" class="button"/>
                    {% endif %}        
                </form>
            </div>
            <div>
                <form action="servicestandards" method="get">
                    {% if session['serviceStandards'] %}
                        <input type="submit" value="Service Standards" id="add-btn" class="button"/>
                    {% else %}
                        <input type="submit" value="Service Standards" id="submit-btn" class="button"/>
                    {% endif %}
                </form>
            </div>
            <div>
                <form action="servicearrangements" method="get">                
                        <input type="submit" value="Service Arrangements" id="submit-btn" class="button"/>                    
                </form>        
            </div>
        </div>
        <div> <!-- column 3 - documents -->
            <div>  
                <form action="clientmsa" method="get">
                    <input type="submit" value="Client MSA" id="submit-btn" class="button"/>
                </form>
            </div>              
            <div>  
                <form action="spmsa" method="get">
                    <input type="submit" value="Candidate MSA" id="submit-btn" class="button"/>
                </form>
            </div>    
            <div>       
                <form action="clientcontract" method="get">
                    <input type="submit" value="Client contract" id="submit-btn" class="button"/>                        
                </form>
            </div>            
        </div>    
    </div>

    {% with messages = get_flashed_messages(category_filter=['error']) %}
        {% if messages %}
            <script>
                // Simple blocking pop-up
                window.addEventListener('DOMContentLoaded', () => {
                    alert( {{ messages[0] | tojson }} );
                });
            </script>
        {% endif %}
    {% endwith %}

    <script>
        $(document).ready(function() {
            $("#sid").on("input", function() {
                let query = $(this).val();
                if (query.length > 0) {
                    $.getJSON("/searchcandidates", { q: query }, function(data) {
                        let suggestions = $("#suggestions");
                        suggestions.empty();
                        data.forEach(function(item) {
                            suggestions.append(`<div>${item}</div>`);
                        });
                    });
                } else {
                    $("#suggestions").empty();
                }
            });

            $("#suggestions").on("click", "div", function() {
                $("#sid").val($(this).text());
                $("#suggestions").empty();
            });
        });
    </script>

{% endblock %}