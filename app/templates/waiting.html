<!DOCTYPE html>

{% extends "base.html" %}

{% block head %}
    {{ super() }}
    <meta http-equiv="refresh" content="3">
    <script>
        // Alternative AJAX-based refresh (optional)
        function checkDbStatus() {
            fetch('/check-db-status')
                .then(response => response.json())
                .then(data => {
                    if (data.ready) {
                        window.location.href = '/';
                    }
                })
                .catch(error => {
                    console.log('Status check failed:', error);
                });
        }
        
        // Check every 3 seconds
        setInterval(checkDbStatus, 3000);
    </script>
{% endblock %}

{% block content %}

<h1>Document Generator</h1>

<h2>Database is resuming...</h2>
<p><small>Please wait. The application will be available shortly.</small></p>

    <div class="waiting-container">
        <div class="waiting-spinner"></div>
        <div class="waiting-message">Connecting to database...</div>
        <div id="error-message" class="waiting-error" style="display: none;"></div>
    </div>
    <script>
        // Poll the database status endpoint
        function checkDatabaseStatus() {
            fetch('/db-status')
                .then(response => response.json())
                .then(data => {
                    if (data.connected) {
                        window.location.href = '/';
                    } else if (data.error) {
                        document.getElementById('error-message').textContent = data.error;
                        document.getElementById('error-message').style.display = 'block';
                        // Still retry after error
                        setTimeout(checkDatabaseStatus, 5000);
                    } else {
                        setTimeout(checkDatabaseStatus, 2000);
                    }
                })
                .catch(error => {
                    console.error('Error checking database status:', error);
                    setTimeout(checkDatabaseStatus, 2000);
                });
        }
        
        // Start checking immediately
        checkDatabaseStatus();
    </script>

    

{% endblock %}